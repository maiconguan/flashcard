<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Flashcard T·ª´ V·ª±ng Ti·∫øng Anh</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f7fb;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }

    .container {
      width: 300px; /* card d·ª±ng ƒë·ª©ng */
      position: relative;
      display: flex;
      justify-content: center;
      align-items: center;
      perspective: 1000px;
    }

    /* ===== SLIDE WRAPPER (GI·ªÆ V·ªä TR√ç CARD) ===== */
    .slide-wrapper {
      width: 100%;
      height: 460px;
      position: relative;
      overflow: visible; /* ‚ùó card kh√¥ng ƒë·∫©y n√∫t */
    }

    /* ===== CARD 3D ===== */
    .card-wrapper {
      width: 100%;
      height: 100%;
      position: absolute;
      top: 0;
      left: 0;
      transform-style: preserve-3d;
      transition: transform 0.7s;
    }

    .card-wrapper.flipped {
      transform: rotateY(180deg);
    }

    .card-face {
      position: absolute;
      inset: 0; /* üëà lu√¥n c·ªë ƒë·ªãnh v·ªã tr√≠ */
      backface-visibility: hidden;
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      cursor: pointer;
    }

    .card-back {
      transform: rotateY(180deg);
    }

    /* ===== SLIDE EFFECT (CH·ªà TR∆Ø·ª¢T WRAPPER) ===== */
    .slide-left {
      animation: slideLeft 0.35s forwards;
    }

    .slide-right {
      animation: slideRight 0.35s forwards;
    }

    @keyframes slideLeft {
      to { transform: translateX(-120%); opacity: 0; }
    }

    @keyframes slideRight {
      to { transform: translateX(120%); opacity: 0; }
    }

    img {
      max-width: 100%;
      border-radius: 10px;
      margin-bottom: 10px;
    }

    .word { font-size: 32px; font-weight: bold; }
    .meaning { font-size: 22px; color: #27ae60; }
    .example { font-size: 16px; color: #555; margin-top: 10px; font-style: italic; }

    /* ===== NAV BUTTONS (C·ªê ƒê·ªäNH THEO CARD) ===== */
    .nav-btn {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 44px;
      height: 44px;
      border-radius: 50%;
      border: none;
      background: rgba(52, 152, 219, 0.95);
      color: white;
      font-size: 22px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 6px 12px rgba(0,0,0,0.25);
      z-index: 5; /* üëà lu√¥n tr√™n card */
    }

    .nav-btn.left { left: -52px; }
    .nav-btn.right { right: -52px; }

    .nav-btn:active {
      transform: translateY(-50%) scale(0.95);
    }
  </style>
</head>
<body>

<div class="container">

  <button class="nav-btn left" onclick="prevCard(); event.stopPropagation();">‚óÄ</button>

  <div id="slideWrapper" class="slide-wrapper">
    <div id="cardWrapper" class="card-wrapper" onclick="flipCard()">
      <div class="card-face" id="front"></div>
      <div class="card-face card-back" id="back"></div>
    </div>
  </div>

  <button class="nav-btn right" onclick="nextCard(); event.stopPropagation();">‚ñ∂</button>

</div>

<script>
  const sheetURL = "https://docs.google.com/spreadsheets/d/1vmqYN5_0lku8q97oxQP3ppQLtSOxTZtL_L0fnAPnF2Y/edit?usp=sharing";

  function extractSheetId(url) {
    const match = url.match(/spreadsheets\/d\/([a-zA-Z0-9-_]+)/);
    return match ? match[1] : null;
  }

  const sheetId = extractSheetId(sheetURL);
  const apiURL = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json`;

  let words = [];
  let index = 0;
  let flipped = false;

  fetch(apiURL)
    .then(res => res.text())
    .then(text => {
      const json = JSON.parse(text.substring(47, text.length - 2));
      words = json.table.rows.map(r => ({
        en: r.c[1]?.v || "",
        vi: r.c[2]?.v || "",
        example: r.c[3]?.v || "",
        image: r.c[4]?.v || ""
      })).filter(w => w.en);

      renderCard();
    });

  function renderCard() {
    const w = words[index];
    front.innerHTML = `
      ${w.image ? `<img src="${w.image}">` : ""}
      <div class="word">${w.en}</div>
      <p>(Click ƒë·ªÉ l·∫≠t th·∫ª)</p>`;

    back.innerHTML = `
      <div class="meaning">${w.vi}</div>
      <div class="example">${w.example}</div>`;
  }

  function flipCard() {
    flipped = !flipped;
    cardWrapper.classList.toggle("flipped", flipped);
  }

  function nextCard() { slideTo(1); }
  function prevCard() { slideTo(-1); }

  function slideTo(direction) {
    slideWrapper.classList.add(direction === 1 ? "slide-left" : "slide-right");

    setTimeout(() => {
      index = (index + direction + words.length) % words.length;
      flipped = false;
      cardWrapper.classList.remove("flipped");
      renderCard();
      slideWrapper.classList.remove("slide-left", "slide-right");
    }, 300);
  }

  /* ===== SWIPE MOBILE ===== */
  let startX = 0;

  cardWrapper.addEventListener("touchstart", e => {
    startX = e.touches[0].clientX;
  });

  cardWrapper.addEventListener("touchend", e => {
    const diff = e.changedTouches[0].clientX - startX;
    if (Math.abs(diff) > 50) diff < 0 ? nextCard() : prevCard();
  });

  console.assert(extractSheetId(sheetURL), "Sheet ID invalid");
</script>

</body>
</html>
