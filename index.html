<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Flashcard Tá»« Vá»±ng Tiáº¿ng Anh</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f7fb;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }

    .container {
      width: 300px; /* khung háº¹p hÆ¡n Ä‘á»ƒ card dá»±ng Ä‘á»©ng */
      position: relative;
      display: flex;
      justify-content: center;
      perspective: 1000px;
    }

    /* ===== CARD 3D ===== */
    .card-wrapper {
      width: 100%;
      height: 460px; /* ðŸ‘ˆ card hÃ¬nh chá»¯ nháº­t dá»±ng Ä‘á»©ng */
      position: relative;
      transform-style: preserve-3d;
      transition: transform 0.7s;
    }

    .card-wrapper.flipped {
      transform: rotateY(180deg);
    }

    .card-face {
      position: absolute;
      width: 100%;
      height: 100%;
      backface-visibility: hidden;
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      cursor: pointer;
    }

    .card-back {
      transform: rotateY(180deg);
    }

    /* ===== SLIDE EFFECT ===== */
    .slide-left {
      animation: slideLeft 0.35s forwards;
    }

    .slide-right {
      animation: slideRight 0.35s forwards;
    }

    @keyframes slideLeft {
      to { transform: translateX(-120%); opacity: 0; }
    }

    @keyframes slideRight {
      to { transform: translateX(120%); opacity: 0; }
    }

    img {
      max-width: 100%;
      border-radius: 10px;
      margin-bottom: 10px;
    }

    .word { font-size: 32px; font-weight: bold; }
    .meaning { font-size: 22px; color: #27ae60; }
    .example { font-size: 16px; color: #555; margin-top: 10px; font-style: italic; }

    /* ===== NAV BUTTONS (LEFT / RIGHT OF CARD) ===== */
    .nav-btn {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 44px;
      height: 44px;
      border-radius: 50%;
      border: none;
      background: rgba(52, 152, 219, 0.9);
      color: white;
      font-size: 22px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 6px 12px rgba(0,0,0,0.25);
      z-index: 10;
    }

    .nav-btn.left { left: -52px; }
    .nav-btn.right { right: -52px; }

    .nav-btn:active { transform: translateY(-50%) scale(0.95); }

    .nav button {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      border: none;
      background: #3498db;
      color: white;
      font-size: 22px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 6px 12px rgba(0,0,0,0.2);
    }

    .nav button:active {
      transform: scale(0.95);
    }
  </style>
</head>
<body>

<div class="container">

  <div id="cardWrapper" class="card-wrapper" onclick="flipCard()">
    <div class="card-face card-front" id="front"></div>
    <div class="card-face card-back" id="back"></div>
  </div>

  <button class="nav-btn left" onclick="prevCard(); event.stopPropagation();">â—€</button>
  <button class="nav-btn right" onclick="nextCard(); event.stopPropagation();">â–¶</button>

</div>

<script>
  /* ================= GOOGLE SHEET ================= */
  const sheetURL = "https://docs.google.com/spreadsheets/d/1vmqYN5_0lku8q97oxQP3ppQLtSOxTZtL_L0fnAPnF2Y/edit?usp=sharing";

  function extractSheetId(url) {
    const match = url.match(/spreadsheets\/d\/([a-zA-Z0-9-_]+)/);
    return match ? match[1] : null;
  }

  const sheetId = extractSheetId(sheetURL);
  const apiURL = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json`;

  let words = [];
  let index = 0;
  let flipped = false;

  fetch(apiURL)
    .then(res => res.text())
    .then(text => {
      const json = JSON.parse(text.substring(47, text.length - 2));
      words = json.table.rows.map(r => ({
        en: r.c[1]?.v || "",
        vi: r.c[2]?.v || "",
        example: r.c[3]?.v || "",
        image: r.c[4]?.v || ""
      })).filter(w => w.en);

      renderCard();
    });

  function renderCard() {
    const w = words[index];
    document.getElementById("front").innerHTML = `
      ${w.image ? `<img src="${w.image}">` : ""}
      <div class="word">${w.en}</div>
      <p>(Click Ä‘á»ƒ láº­t tháº»)</p>`;

    document.getElementById("back").innerHTML = `
      <div class="meaning">${w.vi}</div>
      <div class="example">${w.example}</div>`;
  }

  function flipCard() {
    flipped = !flipped;
    document.getElementById("cardWrapper").classList.toggle("flipped", flipped);
  }

  function nextCard() {
    slideTo(1);
  }

  function prevCard() {
    slideTo(-1);
  }

  function slideTo(direction) {
    const wrapper = document.getElementById("cardWrapper");
    wrapper.classList.add(direction === 1 ? "slide-left" : "slide-right");

    setTimeout(() => {
      index = (index + direction + words.length) % words.length; // ðŸ” vÃ²ng trÃ²n
      flipped = false;
      wrapper.classList.remove("flipped");
      renderCard();
      wrapper.classList.remove("slide-left", "slide-right");
    }, 300);
  }

  console.assert(extractSheetId(sheetURL), "Sheet ID invalid");
  /* ===== SWIPE FOR MOBILE ===== */
  let startX = 0;

  const cardEl = document.getElementById("cardWrapper");

  cardEl.addEventListener("touchstart", e => {
    startX = e.touches[0].clientX;
  });

  cardEl.addEventListener("touchend", e => {
    const endX = e.changedTouches[0].clientX;
    const diff = endX - startX;

    if (Math.abs(diff) > 50) {
      diff < 0 ? nextCard() : prevCard();
    }
  });

</script>

</body>
</html>
